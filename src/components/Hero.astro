---
import { getCollection } from 'astro:content';
import { Icon as AstroIcon } from 'astro-icon/components';
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';

// Update the collection path to match your directory structure
const slides = await getCollection('hero-slides');
const sortedSlides = slides.sort(
  (a: CollectionEntry<'hero-slides'>, b: CollectionEntry<'hero-slides'>) => 
    a.data.order - b.data.order
);

interface Props {
  title: string;
  subtitle: string;
  description: string;
}

const { title, subtitle, description } = Astro.props;
---

<section class="py-8 md:py-16 lg:py-24 overflow-hidden bg-gradient-to-b from-gray-50 to-gray-100">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-center">
      <!-- Content Column -->
      <div class="space-y-6 md:space-y-8">
        <div class="space-y-3 md:space-y-4">
          <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 animate-fade-in">
            {title}
          </h1>
          <h2 class="text-lg md:text-xl lg:text-2xl text-primary-600 font-semibold">
            {subtitle}
          </h2>
        </div>

        <div class="space-y-4 md:space-y-6">
          <slot name="description" />
        </div>
      </div>

      <!-- Image Column with Carousel -->
      <div class="relative h-[400px] lg:h-[600px] rounded-xl lg:rounded-2xl overflow-hidden shadow-xl mt-6 lg:mt-0">
        <div class="carousel-container absolute inset-0">
          {sortedSlides.map((slide: CollectionEntry<'hero-slides'>, index: number) => (
            <div class={`carousel-slide absolute inset-0 transition-opacity duration-1000 ${index === 0 ? 'opacity-100' : 'opacity-0'}`}>
              <Image 
                src={slide.data.image}
                alt={slide.data.title}
                class="w-full h-full object-cover"
                width={1920}
                height={1080}
                quality="mid"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-gray-900/70 via-gray-900/40 to-transparent"></div>
              
              <!-- Service Highlight Card -->
              <div class="absolute bottom-8 md:bottom-12 left-4 right-4 md:left-6 md:right-6 transition-opacity duration-1000">
                <div class="backdrop-blur-sm rounded-lg p-3 md:p-4 transform transition-all duration-500">
                  <div class="flex items-start gap-3">
                    <div class="bg-white/20 backdrop-blur-sm p-2 rounded-lg">
                      <AstroIcon name={slide.data.icon} class="w-5 h-5 md:w-6 md:h-6 text-white" />
                    </div>
                    <div class="flex-1">
                      <h3 class="text-base md:text-lg font-semibold text-white mb-1">
                        {slide.data.serviceTitle}
                      </h3>
                      <p class="text-xs md:text-sm text-white/90 mb-2 line-clamp-2 md:line-clamp-none">
                        {slide.data.serviceDescription}
                      </p>
                      <a 
                        href={slide.data.link} 
                        class="inline-flex items-center text-xs md:text-sm text-white font-medium group hover:text-white/80"
                      >
                        Learn More 
                        <AstroIcon 
                          name="lucide:arrow-right" 
                          class="w-3 h-3 md:w-4 md:h-4 ml-1 transform transition-transform group-hover:translate-x-1" 
                        />
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  function setupCarousel() {
    const slides = document.querySelectorAll('.carousel-slide');
    const dots = document.querySelectorAll('[data-index]');
    let currentSlide = 0;
    const slideCount = slides.length;
    
    function updateSlides(newIndex: number) {
      // Hide all slides
      slides.forEach((slide) => {
        slide.classList.remove('opacity-100');
        slide.classList.add('opacity-0');
      });
      
      // Show the current slide
      slides[newIndex].classList.remove('opacity-0');
      slides[newIndex].classList.add('opacity-100');
      
      // Update dots
      dots.forEach((dot, index) => {
        if (index === newIndex) {
          dot.classList.add('bg-white', 'scale-125');
          dot.classList.remove('bg-white/50');
        } else {
          dot.classList.remove('bg-white', 'scale-125');
          dot.classList.add('bg-white/50');
        }
      });
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % slideCount;
      updateSlides(currentSlide);
    }

    // Set up click handlers for dots
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        currentSlide = index;
        updateSlides(currentSlide);
      });
    });

    // Start the automatic slideshow
    setInterval(nextSlide, 5000); // Change slide every 5 seconds
  }

  // Run setup when the component mounts
  setupCarousel();

  // Handle hot module replacement for development
  if (import.meta.hot) {
    import.meta.hot.accept(() => {
      setupCarousel();
    });
  }
</script> 